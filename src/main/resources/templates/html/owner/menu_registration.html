<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Form</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</head>
<body>
<!-- 일단 주석해놓음 테스트 action="/process-form" method="post"-->
<form id="menuForm" class="container w-50 p-3" >
<!--    storeId값 히든으로 받아오기-->
    <input type="hidden" id="storeId" th:value="${storeId}" />
    <div id="menuList">
    <div class="mb-4">
        <label class="form-label">메뉴 이름</label>
        <input type="text" class="form-control form-control-sm" name="name">
    </div>
    <div class="mb-4">
        <label class="form-label">가격</label>
        <input type="text" class="form-control form-control-sm" name="price">
    </div>

    <div class="mb-4">
        <label class="form-label">내용</label>
        <textarea name="content" id="" cols="10" rows="10" class="form-control"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">카테고리</label>
        <input type="text" class="form-control" name="category">
    </div>

    <div class="input-group mt-5">
        <input type="file" class="form-control" id="inputGroupFile02" name="picturePath">
        <label class="input-group-text" for="inputGroupFile02">업로드</label>
    </div>

    </div>
    <div class="mt-5 d-grid gap-2 d-md-flex justify-content-md-center">
        <button type="button" onclick="addMenuForm()" class="btn btn-secondary">Add Menu</button>
        <button type="submit" id="submitMenu" class="btn btn-secondary">Submit</button>
    </div>
</form>

<script th:inline="javascript">
    function addMenuForm() {
        let menuList = document.getElementById('menuList');
        let index = menuList.children.length;

        // 동적으로 폼을 생성하고 추가
        const formHtml =
            '<div class="mb-4">' +
            '    <label class="form-label">메뉴 이름</label>' +
            '    <input type="text" class="form-control form-control-sm menuName" name="name">' +
            '</div>' +
            '<div class="mb-4">' +
            '    <label class="form-label">가격</label>' +
            '    <input type="text" class="form-control form-control-sm menuName" name="price">' +
            '</div>' +
            '<div class="mb-4">' +
            '    <label class="form-label">내용</label>' +
            '    <textarea name="content" id="" cols="10" rows="10" class="form-control menuName"></textarea>' +
            '</div>' +
            '<div class="mb-3">' +
            '    <label class="form-label">카테고리</label>' +
            '    <input type="text" class="form-control menuName" name="category">' +
            '</div>' +
            '<div class="input-group mt-5">' +
            '    <input type="file" class="form-control menuName" id="inputGroupFile02" name="picturePath">' +
            '    <label class="input-group-text" for="inputGroupFile02">업로드</label>' +
            '</div>';
        const newMenuForm = document.createElement('div');
        newMenuForm.innerHTML = formHtml;

        menuList.appendChild(newMenuForm);
        // menuList.insertAdjacentHTML('beforeend', formHtml);
    }

    // store_id값 받아오기
    const storeId = document.getElementById('storeId').value;

    // 등록 버튼 누르고 이벤트 발동하기
    const submitMenu = document.querySelector('#submitMenu');
    let menuList = [];
    submitMenu.addEventListener('click',(e)=>{
        e.preventDefault();
        const appendMenus = document.querySelectorAll('.menuName');

        appendMenus.forEach(input => {
            menuList.push(input.value);
        })

        // const jsonMenu = JSON.stringify(menuList);
        const url = "/api/store/" + storeId + "/create";
        fetch(url,{
            headers:{
                "Content-Type": "application/json"
            },
            method:'post',
            body: JSON.stringify(menuList),
        }).then(response => {
            const message = (response.ok) ? "가게가 등록되었습니다!" : "가게 등록에 실패했습니다!";
            alert(message);
        })
    })

</script>
</body>
</html>
